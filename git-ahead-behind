#!/bin/sh

usage(){
	echo "Usage: $0 [repo]" >&2
	exit 1
}

if [ $# -eq 1 ]
then repo="$1"
elif [ $# -ne 0 ]
then usage
else repo=origin
fi

revcnt(){
	git rev-list "$1" | wc -l
}

show_ab(){
	rvcnt=`revcnt "${2}..${3}" `
	if [ $rvcnt != 0 ]
	then echo "$1 $rvcnt $3 $4 "
	fi
}

set -e

git config -l | \
grep '^branch\.' | \
sed -n 's%^branch\.%%; s%.merge=refs/heads/% %p' | \
while read local remote
do
	remote="$repo/$remote"
	base=`git merge-base "$local" "$remote"`

	show_ab ahead  "$base" "$local"  "$remote"
	show_ab behind "$base" "$remote" "$remote"
done
